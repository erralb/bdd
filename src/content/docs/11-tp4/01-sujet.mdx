---
title: Projet - La clinique v√©t√©rinaire
sidebar:
  label: Sujet
---

## Objectifs

Le but de ce projet est de revoir tous les concepts vus en cours, TDs et TPs depuis le d√©but du module :

- Normalisation
- Alg√®bre relationnelle
- Requ√™tes SQL (sous-requ√™tes, jointures, agr√©gats)
- Transactions
- Triggers, proc√©dures stock√©es et vues

## √ânonc√©

On souhaite concevoir une base de donn√©es pour une clinique v√©t√©rinaire.

La clinique v√©t√©rinaire est une entreprise qui propose des `soins` pour les `animaux` domestiques. Elle est compos√©e de plusieurs `v√©t√©rinaires`, chacun ayant un _num√©ro_ d'identification unique, un _nom_, un _pr√©nom_, une _adresse_, un num√©ro de _t√©l√©phone_ et une _sp√©cialit√©_ (chien, chat, oiseau, etc.).

Les `clients` de la clinique sont √©galement identifi√©s par un _num√©ro_ d'identification unique, un _nom_, un _pr√©nom_, une _adresse_ et un num√©ro de _t√©l√©phone_.

Les `animaux` soign√©s √† la clinique sont identifi√©s par un _num√©ro_ d'identification unique, un _nom_, une _esp√®ce_ (chien, chat, oiseau) et appartiennent √† un _propri√©taire_ (un `client`)

Les `soins` prodigu√©s √† un animal sont identifi√©s par un _num√©ro_ d'identification unique, une _date_, un `v√©t√©rinaire`, un `animal`, un _diagnostic_ et un _traitement_.

## Sch√©ma propos√©

Le stagiaire en informatique qui a recueilli les besoins du client vous propose le sch√©ma relationnel suivant :

```ansi wrap frame="none"
[1mCLINIQUE[0m ( [4mnumV[0m, nomV, prenomV, adresseV, telephoneV, specialiteV, numC, nomC, prenomC, adresseC, telephoneC, [4mnumA[0m, nomA, dateNaissanceA, especeA, [4mnumS[0m, dateS, diagnosticS, traitementS )
```

Informations compl√©mentaires :

```mermaid
erDiagram
    CLINIQUE {
        int numV PK "Num√©ro du v√©t√©rinaire"
        text nomV "Nom du v√©t√©rinaire"
        text prenomV "Pr√©nom du v√©t√©rinaire"
        text adresseV "Adresse du v√©t√©rinaire"
        text telephoneV "T√©l√©phone du v√©t√©rinaire"
        text specialiteV "Sp√©cialit√© du v√©t√©rinaire"
        int numC "Num√©ro client"
        text nomC "Nom du client"
        text prenomC "Pr√©nom du client"
        text adresseC "Adresse du client"
        text telephoneC "T√©l√©phone du client"
        int numA PK "Num√©ro animal"
        text nomA "Nom de l'animal"
        date dateNaissanceA "Date de naissance de l'animal"
        text especeA "Esp√®ce de l'animal"
        int numS PK "Num√©ro soin"
        date dateS "Date du soin"
        text diagnosticS "Diagnostic du soin"
        text traitementS "Traitement du soin"
    }
```

Code SQL de cr√©ation de la table `CLINIQUE` :

```sql
CREATE TABLE CLINIQUE (
    numV INT,
    nomV TEXT,
    prenomV TEXT,
    adresseV TEXT,
    telephoneV TEXT,
    specialiteV TEXT,
    numC INT,
    nomC TEXT,
    prenomC TEXT,
    adresseC TEXT,
    telephoneC TEXT,
    numA INT,
    nomA TEXT,
    dateNaissanceA DATE,
    especeA TEXT,
    numS INT,
    dateS DATE,
    diagnosticS TEXT,
    traitementS TEXT,
    PRIMARY KEY (numV, numA, numS),
);
```

## 1. Normalisation

_Bar√®me : 5 points_

:::note[Rappel]
La normalisation consiste √† organiser les donn√©es d'une base de donn√©es relationnelle en tables pour √©viter la redondance et les anomalies de mise √† jour.
:::

##### 1. Identifiez les d√©pendances fonctionnelles de ce sch√©ma
##### 2. Est-ce que le sch√©ma propos√© est en 2NF ? en 3NF ? Justifiez vos r√©ponses
##### 3. Proposez une d√©composition en 3NF de cette relation

_Votre sch√©ma textuel en 3NF doit pr√©ciser les cl√©s primaires et √©trang√®res de chaque table._

:::tip[Rendu]
Sauvegardez vos DF, justifications et d√©composition 3NF dans un fichier texte nomm√© : 

`1-clinique-normalisation.md`
:::

_Les fichiers avec l'extension .md sont des fichiers de texte simple au format **Markdown**. Vous pouvez les √©diter avec un √©diteur de texte comme Visual Studio Code ou Notepad++. Vous pouvez aussi t√©l√©charger/exporter des documents Google Docs ou Office directement au format MarkDown_

## 2. SQL DDL

_Bar√®me : 5 points_

:::note[Rappel]
Le DDL (Data Definition Language) est un sous-langage de SQL permettant de d√©finir la structure des donn√©es dans une base de donn√©es relationnelle.
:::

##### 1. T√©l√©chargez la base de donn√©es [clinique-non-normalisee.sqlite](/bdd/clinique/clinique-non-normalisee.sqlite)

   _Cette base de donn√©es contient une seule table de donn√©es non normalis√©e `CLINIQUE`_

##### 2. Renommez le fichier t√©l√©charg√© en `clinique.sqlite`, puis ouvrez-le dans SQLiteStudio ou un autre outil de votre choix

##### 3. R√©digez le code SQL pour cr√©er les tables normalis√©es que vous avez propos√©es dans la partie 1 :

   - Pensez √† d√©finir les cl√©s primaires et √©trang√®res
   - Utilisez des types de donn√©es appropri√©s pour chaque colonne
   - D√©finissez les contraintes statiques (_NOT NULL_, _UNIQUE_, _CHECK_, _DEFAULT_) si vous le jugez n√©cessaire
   - D√©finissez le comportement de suppression des cl√©s √©trang√®res en cas de suppression d'une ligne parente (_CASCADE_, _SET NULL_, _SET DEFAULT_, _NO ACTION_)

##### 4. Proposez les requ√™tes SQL pour ins√©rer les donn√©es dans ces tables en utilisant des [requ√™tes INSERT depuis un SELECT](/bdd/07-sql3/02-sql-dml/#depuis-un-select)

:::tip[Rendu]
Sauvegardez votre code SQL DDL de cr√©ation des tables et d'insertion des donn√©es dans un fichier texte nomm√© : 

`2-clinique-ddl.sql`
:::

_L'extension de fichier .sql est utilis√©e pour pr√©ciser les fichiers de script SQL, mais ce sont des fichiers de texte simple que vous pouvez √©diter avec un √©diteur de texte comme Visual Studio Code ou Notepad++_

## 3. Requ√™tes

### 3.1. Alg√®bre relationnelle

_Bar√®me : 5 points_

Proposez l'alg√®bre relationnelle pour les requ√™tes suivantes :

##### 1. Afficher les `noms` et `pr√©noms` des `v√©t√©rinaires`
##### 2. Afficher le `nom` des `animaux` ainsi que le `nom` et `pr√©nom` de leur `propri√©taire`
##### 3. Afficher les noms des `animaux` soign√©s par le `v√©t√©rinaire` num√©ro `1`, ainsi que les informations du `v√©t√©rinaire` et du `soin` prodigu√©
##### 4. Afficher les `animaux` qui ont `plus de 5 ans`
##### 5. Afficher les `noms` et `pr√©noms` des `v√©t√©rinaires` qui ont soign√© `tous les animaux`

:::tip[Rendu]
Sauvegardez vos requ√™tes d'alg√®bre relationnelle dans un fichier texte nomm√© :

 `3-1-clinique-algebre.md`
:::

### 3.2. Requ√™tes SQL

_Bar√®me : 5 points_

Proposez les requ√™tes SQL pour les requ√™tes suivantes :

##### 1. Afficher les `noms` et `pr√©noms` des `v√©t√©rinaires`
##### 2. Afficher le `nom` des `animaux` ainsi que le `nom` et `pr√©nom` de leur `propri√©taire`
##### 3. Afficher les `animaux` `soign√©s` par le `v√©t√©rinaire` num√©ro `1`, ainsi que les informations du `v√©t√©rinaire` et du `soin` prodigu√©
##### 4. Afficher les `animaux` qui ont `plus de 5 ans`
##### 5. Afficher les `noms` et `pr√©noms` des v√©t√©rinaires qui ont soign√© `tous les animaux`
##### 6. Afficher le `nombre` d'animaux soign√©s par chaque `v√©t√©rinaire`
##### 7. Afficher les `clients` qui ont plus de `1` animal
##### 8. Afficher le `nombre` de soins effectu√©s pour chaque `animal`
##### 9. Afficher le `nombre` d'animaux par `esp√®ce`
##### 10. Afficher les v√©t√©rinaires qui ont soign√© au moins un `chien` et un `chat`

:::tip[Rendu]
Sauvegardez vos requ√™tes SQL dans un fichier texte nomm√© :

`3-2-clinique-dql.sql`
:::

## 4. SQL DML

_Bar√®me : 5 points_

Proposez des requ√™tes SQL pour les actions suivantes :

##### 1. Ajouter un nouveau v√©t√©rinaire
##### 2. Ajouter un nouveau client
##### 3. Ajouter un nouvel animal pour le client pr√©c√©demment ajout√©
##### 4. Ajouter un nouveau soin pour le v√©t√©rineaire et l'animal pr√©c√©demment ajout√©

_Attention, pour chaque ajout, vous deverez retrouver les num√©ros d'identification des √©l√©ments pr√©c√©demment ajout√©s avec des requ√™tes SELECT (par exemple en recherchant par _nom_ et _pr√©nom_ ), pas en utilisant directement des identifiants._

##### 5. Modifier le nom du v√©t√©rinaire num√©ro 1
##### 6. Supprimer le client num√©ro 1. _Tous les animaux et soins associ√©s √† ce client doivent √©galement √™tre supprim√©s automatiquement gr√¢ce √† votre configuration du comportement en cascade._

:::tip[Rendu]
Sauvegardez votre transaction SQL dans un fichier texte nomm√© :

 `4-clinique-dml.sql`
:::

## 5. Evolution du sch√©ma

_Bar√®me : 3 points_

Le client souhaite ajouter une nouvelle table `FACTURES` pour g√©rer les factures des clients. Cette table doit contenir les informations suivantes :

- `numF` : num√©ro de la facture (cl√© primaire)
- `numS` : num√©ro du soin (cl√© √©trang√®re)
- `dateF` : date de la facture
- `montantF` : montant de la facture
- `payeeF` : indique si la facture a √©t√© pay√©e ou non

##### Proposez le code SQL pour cr√©er cette nouvelle table et les contraintes n√©cessaires.

:::tip[Rendu]
Sauvegardez votre code SQL de cr√©ation de la table `FACTURE` dans un fichier texte nomm√© :

`5-clinique-evolution.sql`
:::

## 6. Triggers, proc√©dures stock√©es et vues

_Bar√®me : 12 points_

R√©digez le code SQL pour les actions suivantes :

##### 1. Une vue qui permet d'afficher les animaux soign√©s par le v√©t√©rinaire num√©ro 1

##### 2. Une proc√©dure stock√©e qui permet de g√©n√©rer une ligne de facture pour tous les soins qui n'ont pas encore √©t√© factur√©s :

    - La date de la facture est la date du soin
    - Le montant de la facture est de 50‚Ç¨
    - La facture est marqu√©e comme non pay√©e
    - La facture ne doit pas √™tre g√©n√©r√©e si une ligne de facture existe d√©j√† pour ce soin

<details>
<summary>_SQLite ne supportant pas directement les proc√©dures stock√©es, vous pouvez :_</summary>

- Soit proposer le code SQL pour une proc√©dure stock√©e dans un autre SGBD (MySQL, PostgreSQL, SQL Server, Oracle, etc.)
    - Par exemple, vous pouvez directement importer l'[export de la clinique non normalis√©e](/bdd/public/clinique/clinique-non-normalisee-sqlite-EXPORT.sql) dans [MySQL](https://dev.mysql.com/downloads/installer/), puis executer vos requ√™tes DDL pour cr√©er les tables normalis√©es
- Soit proposer le code SQL pour une transaction qui effectue la m√™me op√©ration
- Soit proposer une fonction qui effectue la m√™me op√©ration dans un langage de programmation (PHP, Javascript, Python, Java, C#, etc.)

</details>

##### 3. Un trigger qui permet de mettre √† jour le montant de la facture √† 1000‚Ç¨ si le traitement du soin contient le mot "chirurgie"

_Dans SQLiteStudio, vous pouvez ajouter des triggers dans l'onglet "Triggers" des tables.
Lorsque vous ajoutez un trigger dans SQLiteStudio, vous n'avez pas besoin de changer le DELIMITER._

Pour tester le trigger, vous pouvez ajouter un soin avec le traitement contenant le mot "chirurgie", relancer votre proc√©dure pr√©c√©dente pour g√©n√©rer les factures, puis v√©rifier que le montant de la facture est bien de 1000‚Ç¨.

Pensez √† inclure vos requ√™tes de test dans le fichier de rendu.

:::tip[Rendu]
Sauvegardez votre code SQL dans un fichier texte nomm√© :

`6-clinique-triggers.sql`
:::
